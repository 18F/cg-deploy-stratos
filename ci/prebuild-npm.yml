platform: linux

image_resource:
  type: docker-image
  source:
    repository: node
    tag: 10

inputs:
- name: stratos-src
- name: stratos-config

outputs:
- name: stratos-prebuilt

params:
  NG_CLI_ANALYTICS: "false"

run:
  path: sh
  args:
  - -exc
  - |
    cd stratos-src
    ln -sf ../stratos-config/custom-src .
    npm install
    npm run store-git-metadata
    npm run customize
    npm run prebuild-ui
    cp -a . ../stratos-prebuilt
